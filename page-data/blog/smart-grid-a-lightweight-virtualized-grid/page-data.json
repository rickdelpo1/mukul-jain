{"componentChunkName":"component---src-pages-markdown-remark-frontmatter-slug-js","path":"/blog/smart-grid-a-lightweight-virtualized-grid/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p>Live Demo: <a href=\"https://mukuljainx.github.io/smart-grid/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Smart Grid</a></p>\n</blockquote>\n<p>There are penality of React tables, everyone got its pros and cons but they all are pretty heavy, they all have almost the same features and few outstanding features and then there is <a href=\"https://www.ag-grid.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ag-grid</a> full of awesome feature but it is pretty heavy half of our vendor bundle was ag-grid ~ 200kb (gzipped 😱).</p>\n<p>Okay so change the table, right? but there is no another package which provides the pinning feature so well, in most of the package, the tables scroll goes out of sync due to prioritization in JS. One fine Saturday it clicked me what if those two tables don’t have different vertical scroll but they are inside one container which is scrollable and they have different horizontal scrolls. Obviously the height of the tables will be the same, so scroll will always be in sync.</p>\n<p>Something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\r\n  <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n    height<span class=\"token operator\">:</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span>\r\n    width<span class=\"token operator\">:</span> <span class=\"token number\">700</span><span class=\"token punctuation\">,</span>\r\n    border<span class=\"token operator\">:</span> <span class=\"token string\">\"1px solid\"</span><span class=\"token punctuation\">,</span>\r\n    display<span class=\"token operator\">:</span> <span class=\"token string\">\"flex\"</span><span class=\"token punctuation\">,</span>\r\n    overflow<span class=\"token operator\">:</span> <span class=\"token string\">\"auto\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\r\n<span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\r\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\r\n    <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n      height<span class=\"token operator\">:</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">,</span>\r\n      width<span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span>\r\n      border<span class=\"token operator\">:</span> <span class=\"token string\">\"1px solid red\"</span><span class=\"token punctuation\">,</span>\r\n      flexShrink<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\r\n  <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\r\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\r\n    <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n      height<span class=\"token operator\">:</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">,</span>\r\n      width<span class=\"token operator\">:</span> <span class=\"token number\">800</span><span class=\"token punctuation\">,</span>\r\n      border<span class=\"token operator\">:</span> <span class=\"token string\">\"1px solid blue\"</span><span class=\"token punctuation\">,</span>\r\n      flexShrink<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\r\n  <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\r\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>If you will run this code you will both <strong>div</strong>’s are in sync vertically but the whole container is scrolling horizontally, but we want our unpinned table, i.e. right one for now to scroll, how to solve that? Simply add the right table inside a div with <code class=\"language-text\">overflowX:auto</code>, something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\r\n  <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n    height<span class=\"token operator\">:</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span>\r\n    width<span class=\"token operator\">:</span> <span class=\"token number\">700</span><span class=\"token punctuation\">,</span>\r\n    border<span class=\"token operator\">:</span> <span class=\"token string\">\"1px solid\"</span><span class=\"token punctuation\">,</span>\r\n    display<span class=\"token operator\">:</span> <span class=\"token string\">\"flex\"</span><span class=\"token punctuation\">,</span>\r\n    overflow<span class=\"token operator\">:</span> <span class=\"token string\">\"auto\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\r\n<span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\r\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\r\n    <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n      height<span class=\"token operator\">:</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">,</span>\r\n      width<span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span>\r\n      border<span class=\"token operator\">:</span> <span class=\"token string\">\"1px solid red\"</span><span class=\"token punctuation\">,</span>\r\n      flexShrink<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\r\n  <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\r\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> overflowX<span class=\"token operator\">:</span> <span class=\"token string\">\"auto\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\r\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\r\n      <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n        height<span class=\"token operator\">:</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">,</span>\r\n        width<span class=\"token operator\">:</span> <span class=\"token number\">800</span><span class=\"token punctuation\">,</span>\r\n        border<span class=\"token operator\">:</span> <span class=\"token string\">\"1px solid blue\"</span><span class=\"token punctuation\">,</span>\r\n        flexShrink<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\r\n    <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\r\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\r\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h2>Working Demo</h2>\n<iframe src=\"https://codesandbox.io/embed/sad-kilby-0y4pl?fontsize=14&hidenavigation=1&theme=dark&view=preview\"\r\n     style=\"width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;\"\r\n     title=\"virtualized-table\"\r\n     allow=\"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking\"\r\n     sandbox=\"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts\"\r\n   ></iframe>\n<p>Major Problem Solved 🎉 then I inspected ag-grid demo page to check what they do and voila, they are doing almost the same thing.</p>\n<p>Cool! but what about virtualization?</p>\n<h2>Virtualization</h2>\n<p>I am very lazy and hate reinventing the wheel, so I searched for packages which provide virtualization and found some, so I tried using them with the above code, the result was something like this, refer to table with <strong>virtual table</strong> heading. The package I used is <strong>react-tiny-virtual-list</strong> which obviously is not at fault, it is doing what it is supposed to.</p>\n<iframe src=\"https://codesandbox.io/embed/table-virtual-j1o8u?fontsize=14&hidenavigation=1&theme=dark&view=preview\"\r\n     style=\"width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;\"\r\n     title=\"table-virtual\"\r\n     allow=\"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking\"\r\n     sandbox=\"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts\"\r\n   ></iframe>\n<p>There is one more table there, below that one is also virtualized else tab will be hanged with large data, so how I achieved it, by calculating current position using <code class=\"language-text\">**scrollOffset</code>** then calculating a start &#x26; end position something like</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> start <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>position <span class=\"token operator\">-</span> buffer <span class=\"token operator\">-</span> visibleCount<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> end <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>position <span class=\"token operator\">+</span> buffer <span class=\"token operator\">+</span> visibleCount<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Then just rendering just those rows, It was not expected to go fine in one go as I didn’t think virtualization was this simple, but that is what it is! 🙅‍♂️</p>\n<p>I also tried using fast-memoize to memoize rows so they won’t be recalculated thus saving some work which results in smooth scrolling experience but page started crashing for the huge data set due to increased JS heap size.</p>\n<p>I went through react-virtualized to what they have done and I found very amazing thing there, cache while scroll and clear it when scroll stops. Create a local cache always look for grid row in the cache first if not create row &#x26; cache it. Assign an empty object to the cache when the user stops scrolling.</p>\n<h2>Dynamic Height</h2>\n<p>Dynamic height is also supported in version <code class=\"language-text\">v0.1.0</code> , this is achieved by rendering rows twice once for getting the height of the row at some fixed position and the second time with calculated height &#x26; positions, these values are cached so when the user scrolls to the previously viewed rows they are only rendered once as we already have their height and position stored in cache.</p>\n<p>When data changes for any row, recalculation may be needed but this has been left user by providing <code class=\"language-text\">gridActions</code> as the user can predict when the height may change and the cache will not be cleared every time the data changes. You view the live demo at <a href=\"https://mukuljainx.github.io/smart-grid/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://mukuljainx.github.io/smart-grid/</a></p>\n<p>That’s how <a href=\"https://mukuljainx.github.io/smart-grid/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">smart-grid</a> came to existence, it’s an open-source project please open a PR or issue if needed on <a href=\"https://github.com/mukuljainx/smart-grid\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Github</a>. 😇</p>","frontmatter":{"date":"March 08, 2020","slug":"/blog/Smart-Grid-A-Lightweight-virtualized-grid","title":"Smart Grid: A Lightweight virtualized grid."}}},"pageContext":{"id":"a2495b2d-81c7-52f6-b7b0-9362a544efc4","frontmatter__slug":"/blog/Smart-Grid-A-Lightweight-virtualized-grid","__params":{"frontmatter__slug":"blog"}}},"staticQueryHashes":["3897982121"]}